<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Archiving Data to HPSS &mdash; AMReX-Astro 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css?v=5694489b" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=f2a433a1"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Visualization at NERSC" href="nersc-visualization.html" />
    <link rel="prev" title="Managing Jobs at NERSC" href="nersc-workflow.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            AMReX-Astro
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">AMReX Astro basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="alcf.html">Working at ALCF</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="nersc.html">Working at NERSC</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nersc-compilers.html">Compiling at NERSC</a></li>
<li class="toctree-l2"><a class="reference internal" href="nersc-workflow.html">Managing Jobs at NERSC</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Archiving Data to HPSS</a></li>
<li class="toctree-l2"><a class="reference internal" href="nersc-visualization.html">Visualization at NERSC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="olcf.html">Working at OLCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="iacs.html">Working at IACS</a></li>
<li class="toctree-l1"><a class="reference internal" href="workstations.html">Linux Workstations</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AMReX-Astro</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="nersc.html">Working at NERSC</a></li>
      <li class="breadcrumb-item active">Archiving Data to HPSS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/nersc-hpss.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="archiving-data-to-hpss">
<h1>Archiving Data to HPSS<a class="headerlink" href="#archiving-data-to-hpss" title="Link to this heading">¶</a></h1>
<p>The <a class="reference external" href="https://docs.nersc.gov/filesystems/archive/">NERSC HPSS Archive</a>
is a large tape library that can store the simulations files for long
periods of time.  It is recommended to move your data to HPSS
frequently, since the scratch filesystems fill up and NERSC will purge
data periodically.</p>
<p>The script <code class="docutils literal notranslate"><span class="pre">nersc.xfer.slurm</span></code> in <code class="docutils literal notranslate"><span class="pre">job_scripts/perlmutter/</span></code>:</p>
<p><a class="reference download internal" download="" href="_downloads/05203ba4d0d4aa143482b601abe7c8b1/nersc.xfer.slurm"><code class="xref download docutils literal notranslate"><span class="pre">nersc.xfer.slurm</span></code></a></p>
<p>can be used to archive data to
HPSS automatically. This is submitted to the xfer queue and runs the
script <code class="docutils literal notranslate"><span class="pre">process.xrb</span></code> in <code class="docutils literal notranslate"><span class="pre">job_scripts/hpss/</span></code>:</p>
<p><a class="reference download internal" download="" href="_downloads/cd10ec9dd07537d7054ccb73c28380f4/process.xrb"><code class="xref download docutils literal notranslate"><span class="pre">process.xrb</span></code></a></p>
<p>which continually looks for output and stores it to HPSS.
By default, the destination directory on HPSS will be have the same name
as the directory your plotfiles are located in.  This can be changed by
editing the``$HPSS_DIR`` variable at the top of <code class="docutils literal notranslate"><span class="pre">process.xrb</span></code>.</p>
<p>The following describes how to use the scripts:</p>
<ol class="arabic">
<li><p>Copy the <code class="docutils literal notranslate"><span class="pre">process.xrb</span></code> script and the slurm script <code class="docutils literal notranslate"><span class="pre">nersc.xfer.slurm</span></code>
into the directory with the plotfiles.</p></li>
<li><p>Submit the archive job:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1">sbatch<span class="w"> </span>nersc.xfer.slurm</span>
</pre></div></div><p>The script <code class="docutils literal notranslate"><span class="pre">process.xrb</span></code> is called from the xfer job and will run in
the background and continually wait until checkpoint or plotfiles are
created.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">process.xrb</span></code> always leaves the most recent plotfile and checkpoint file alone, since
data may still be written to it.</p>
</div>
<p>The script will use <code class="docutils literal notranslate"><span class="pre">htar</span></code> to archive the plotfiles and
checkpoints to HPSS.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">htar</span></code> command was successful, then the plotfiles are
copied into a <code class="docutils literal notranslate"><span class="pre">plotfile/</span></code> subdirectory. This is actually important,
since you don’t want to try archiving the data a second time and
overwriting the stored copy, especially if a purge took place. The
same is done with checkpoint files.</p>
</li>
</ol>
<p>Some additional notes:</p>
<ul>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">ftime</span></code> executable is in your path (<code class="docutils literal notranslate"><span class="pre">ftime.cpp</span></code> lives in
<code class="docutils literal notranslate"><span class="pre">amrex/Tools/Plotfile/</span></code>), then the script will create a file
called <code class="docutils literal notranslate"><span class="pre">ftime.out</span></code> that lists the name of the plotfile and the
corresponding simulation time.</p></li>
<li><p>Right when the job is run, the script will tar up all of the
diagnostic files, <code class="docutils literal notranslate"><span class="pre">ftime.out</span></code>, submission script, and inputs and
archive them on HPSS. The <code class="docutils literal notranslate"><span class="pre">.tar</span></code> file is given a name that contains
the date-string to allow multiple archives to co-exist.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">process.xrb</span></code> is running, it creates a lockfile (called
<code class="docutils literal notranslate"><span class="pre">process.jobid</span></code>) that ensures that only one instance of the script
is running at any one time.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Sometimes if the job is not terminated normally, the
<code class="docutils literal notranslate"><span class="pre">process.jobid</span></code> file will be left behind. Later jobs should be
able to detect this and clean up the stale lockfile, but if this
doesn’t work, you can delete the file if you know the script is not
running.</p>
</div>
</li>
</ul>
<p>Jobs in the xfer queue start up quickly. The best approach is to start
one as you start your main job (or make it dependent on the main
job). The sample <code class="docutils literal notranslate"><span class="pre">process.xrb</span></code> script will wait for output and then
archive it as it is produced.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nersc-workflow.html" class="btn btn-neutral float-left" title="Managing Jobs at NERSC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="nersc-visualization.html" class="btn btn-neutral float-right" title="Visualization at NERSC" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, AMReX-Astro development tem.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>